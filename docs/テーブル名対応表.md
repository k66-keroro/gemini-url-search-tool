# テーブル名対応表

このドキュメントでは、元のファイル名とSQLiteデータベースのテーブル名の対応関係を整理しています。

## テーブル名の変換ルール

SQLiteデータベースでは、テーブル名に日本語や特殊文字を含めることができないため、以下のルールで変換しています：

1. **日本語を含むテーブル名**:
   - `t_` プレフィックスとハッシュ値を付与
   - 例: `品目入出庫` → `t_1234`

2. **先頭が数字のテーブル名**:
   - `t_` プレフィックスを付与
   - 例: `123_table` → `t_123_table`

3. **特殊文字を含むテーブル名**:
   - 特殊文字を `_` に置換
   - 例: `table-name` → `table_name`

## t_プレフィックスのテーブル対応表

| SQLiteテーブル名 | 元のファイル名                   | 元のテーブル名           |
| ----------- | ------------------------- | ----------------- |
| t_0343      | 払出明細（滋賀）_ZPR01201.txt     | 払出明細（滋賀）_ZPR01201 |
| t_1177      | 払出明細（大阪）_ZPR01201.txt     | 払出明細（大阪）_ZPR01201 |
| t_3189      | dbo_提出用_経理_滞留在庫資料_通常.xlsx | 品目入出庫             |
| t_7361      | 資料依頼未完了一覧.xlsx            | plm_資料依頼          |
| t_8426      | ZPF01802_未完了分.TXT         | ZPF01802_未完了分     |
| t_zp138引当   | ZP138.txt                 | ZP138引当（特殊処理）     |

## 特殊処理テーブル

### t_zp138引当

このテーブルは、`ZP138.txt`ファイルから特殊処理によって生成されます。通常の`zp138`テーブルとは別に、引当計算などの特殊なビジネスロジックを適用した結果が格納されています。

特殊処理の詳細は以下のファイルで実装されています：
- `src/processors/zp138_processor.py`

## テーブル名変換ロジック

テーブル名の変換は、`src/main.py`の`_sanitize_table_name`関数で行われています：

```python
def _sanitize_table_name(table_name: str) -> str:
    """
    テーブル名を適切に変換（日本語や特殊文字を避ける）
    """
    import re
    
    # 日本語文字を含むかチェック
    has_japanese = re.search(r'[ぁ-んァ-ン一-龥]', table_name)
    
    # 日本語文字を含む場合は、プレフィックスを付ける
    if has_japanese:
        sanitized = f"t_{hash(table_name) % 10000:04d}"
    else:
        # 英数字以外の文字を_に置換
        sanitized = re.sub(r'[^a-zA-Z0-9]', '_', table_name)
        
        # 連続する_を単一の_に置換
        sanitized = re.sub(r'_+', '_', sanitized)
        
        # 先頭が数字の場合、t_を付ける
        if sanitized[0].isdigit():
            sanitized = f"t_{sanitized}"
            
        # 先頭と末尾の_を削除
        sanitized = sanitized.strip('_')
        
    return sanitized
```