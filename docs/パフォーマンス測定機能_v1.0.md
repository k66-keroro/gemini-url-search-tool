# パフォーマンス測定機能 v1.0

## 概要

全データ更新処理の実行時間を詳細に測定・分析する機能です。処理の良化・悪化を定量的に把握できます。

## 主要機能

### 1. 詳細な時間測定

- **開始・終了時刻**: 処理の開始と終了時刻を記録
- **段階別時間**: テーブル削除、ファイル処理、インデックス設定の各段階の時間
- **総実行時間**: 全体の処理時間

### 2. ファイル別パフォーマンス分析

- **個別処理時間**: 各ファイルの処理時間を記録
- **処理速度**: 行/秒での処理速度を計算
- **処理時間順ソート**: 時間のかかるファイルを特定

### 3. ログ出力例

```
=== 全件データ更新（洗い替え）開始 ===
開始時刻: 2025-01-28 14:30:15
既存テーブルの削除を開始...
15 個のテーブルを削除しました（0.25秒）
処理対象ファイル数: 12

ファイル処理開始: zf26.csv
ファイル処理完了: zf26.csv → テーブル zf26: 37,146 行 (2.45秒)

ファイル処理開始: ZP138.txt
ファイル処理完了: ZP138.txt → テーブル t_zp138引当: 45,230 行 (195.30秒)

インデックスとキーの設定を開始...
主キー追加: zf26._rowid_
インデックス作成: idx_zf26_得意先コード
データベース最終化完了: 12テーブル処理, 23インデックス作成
インデックスとキーの設定が完了しました（3.45秒）

=== 全件データ更新完了 ===
終了時刻: 2025-01-28 14:32:48
処理ファイル数: 12/12
総行数: 125,430 行
ファイル処理時間: 145.30秒
総実行時間: 153.25秒

--- ファイル別処理時間 ---
ZP138.txt: 195.30秒 (45,230行, 232行/秒)
zf26.csv: 2.45秒 (37,146行, 15,162行/秒)
zm37.txt: 1.23秒 (8,450行, 6,870行/秒)
...
```

## 実装詳細

### 時間測定ポイント

1. **全体処理時間**
   ```python
   start_time = time.time()
   # ... 処理 ...
   total_time = time.time() - start_time
   ```

2. **段階別時間**
   ```python
   delete_start = time.time()
   # テーブル削除処理
   delete_time = time.time() - delete_start
   
   process_start = time.time()
   # ファイル処理
   process_time = time.time() - process_start
   
   finalize_start = time.time()
   # インデックス設定
   finalize_time = time.time() - finalize_start
   ```

3. **ファイル別時間**
   ```python
   file_times = []
   for file_path in data_files:
       file_start = time.time()
       # ファイル処理
       file_time = time.time() - file_start
       file_times.append((file_path.name, file_time, row_count))
   ```

### パフォーマンス分析

- **処理速度計算**: `rows_per_sec = row_count / file_time`
- **時間順ソート**: `sorted(file_times, key=lambda x: x[1], reverse=True)`
- **ボトルネック特定**: 最も時間のかかるファイルを特定

## 活用方法

### 1. パフォーマンス監視

- 定期的な実行時間の記録
- 処理時間の変化を追跡
- システム負荷の影響を分析

### 2. 最適化の効果測定

- コード改善前後の比較
- ハードウェア変更の効果測定
- データ量増加の影響分析

### 3. ボトルネック特定

- 時間のかかるファイルの特定
- 処理速度の低いファイルの分析
- 改善対象の優先順位付け

## 今後の拡張

1. **履歴管理**: 過去の実行時間を保存・比較
2. **グラフ化**: 処理時間の推移をグラフで表示
3. **アラート機能**: 処理時間が閾値を超えた場合の通知
4. **詳細分析**: メモリ使用量、CPU使用率の測定