一発 Streamlit でのダッシュボードにして見たい(/・ω・)/
1）追記！週の単位が違うよぉ
6/30は6月の第5週、同じ週だが7/1は7月の第1週

**m_calendar**
|DateColumn|週区分|day of week|holiday|
|---|---|---|---|
|2025/07/01|1|火曜日||
|2025/07/02|1|水曜日||
|2025/07/03|1|木曜日||
|2025/07/04|1|金曜日||
|2025/07/05|1|土曜日|1|
|2025/07/06|2|日曜日|1|
|2025/07/07|2|月曜日||
|2025/07/08|2|火曜日||
|2025/07/09|2|水曜日||
|2025/07/10|2|木曜日||
|2025/07/11|2|金曜日||
|2025/07/12|2|土曜日|1|
|2025/07/13|3|日曜日|1|
|2025/07/14|3|月曜日||
|2025/07/15|3|火曜日||
|2025/07/16|3|水曜日||
|2025/07/17|3|木曜日||
|2025/07/18|3|金曜日||
|2025/07/19|3|土曜日|1|
|2025/07/20|4|日曜日|1|
|2025/07/21|4|月曜日|1|
|2025/07/22|4|火曜日||
|2025/07/23|4|水曜日||
|2025/07/24|4|木曜日||
|2025/07/25|4|金曜日||
|2025/07/26|4|土曜日|1|
|2025/07/27|5|日曜日|1|
|2025/07/28|5|月曜日||
|2025/07/29|5|火曜日||
|2025/07/30|5|水曜日||
|2025/07/31|5|木曜日||

2）過去データもぶち込みたいですね！
zm29日々更新とサーバーに過去データ一応ありますが効率の良い案策定お願いします。















ここまで＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝

1）下記データを元に作成
C:\Users\sem3171\claude-test\data\raw
PP_SUMMARY_ZTBP080_KOJOZISSEKI_D_0.xlsx or ZM29.txt
2）週単位、日単位、での集計
3）確認やバックボーンとして明細
4）calendar は月別の週単位の識別が可能なら不要！ここでしか使用してない

5）下記にクエリや結果を張り付けた！まとまっては無いけどポイントは押さえた(/・ω・)/つもり。。。

使用クエリ
`|   |
|---|
|DoCmd.OpenQuery "t_作成_pc_生産実績_日別集計"|
|SELECT " " AS 週区分, CDate([集計_mrp/日別生産]![日付]) AS 完成日, [集計_mrp/日別生産].*, 集計_日別生産.金額の合計 AS 日別金額 INTO pc_生産実績_日別集計|
|FROM [集計_mrp/日別生産] INNER JOIN 集計_日別生産 ON [集計_mrp/日別生産].日付 = 集計_日別生産.日付;|
||
||
||
||
|DoCmd.OpenQuery "週区分_update"|
|UPDATE pc_生産実績_日別集計 INNER JOIN m_calendar ON pc_生産実績_日別集計.完成日 = m_calendar.DateColumn SET pc_生産実績_日別集計.週区分 = [m_calendar]![週区分];|
||
||
|DoCmd.OpenQuery "週区分_update2"|
|UPDATE pc_生産実績_日別集計|
|SET|
|pc_生産実績_日別集計.週区分 = "合計"|
|WHERE|
|(((pc_生産実績_日別集計.週区分) = ""));|
||
||
|集計_mrp/日別生産|
|TRANSFORM Sum(pc_生産実績_明細.金額) AS 金額の合計|
|SELECT|
|IIf([Seq] = 1, Left([転記日付], 10), "合計") AS 日付|
|FROM|
|pc_生産実績_明細,|
|t_seq|
|GROUP BY|
|IIf([Seq] = 1, Left([転記日付], 10), "合計") PIVOT pc_生産実績_明細.mrp管理者 IN ("PC1", "PC2", "PC4", "PC5", "PC6");|
||
||
||
|pc_生産実績_明細|
|SELECT public_zm29.転記日付, public_zm29.[ネットワーク・指図番号], public_zm29.品目コード, public_zm29.品目テキスト, public_zm29.計画数, public_zm29.完成数, Nz([public_zm29]![単価])*Nz([public_zm29]![完成数]) AS 金額, public_zm29.mrp管理者, m_calendar.週区分|
|FROM public_zm29 INNER JOIN m_calendar ON public_zm29.転記日付 = m_calendar.DateColumn|
|WHERE (((public_zm29.mrp管理者) Like "P*"));|`

calendar
`|   |
|---|
|Public Sub calendar()|
|Dim startDate As Date|
|Dim endDate As Date|
|Dim currentDate As Date|
|Dim db As DAO.Database|
|Dim rs As DAO.Recordset|
||
|' 開始日と終了日を設定|
|'startDate = #4/1/2024#|
|'endDate = #3/31/2025#|
||
|startDate = #4/1/2025#|
|endDate = #3/31/2026#|
||
|' Accessデータベースの参照|
|Set db = CurrentDb|
||
|' レコードセットの作成|
|Set rs = db.OpenRecordset("m_calendar", dbOpenDynaset)|
||
|' 日付テーブルの作成|
|currentDate = startDate|
|Do While currentDate <= endDate|
|rs.AddNew|
|rs!DateColumn = currentDate|
|rs.Update|
|currentDate = currentDate + 1|
|Loop|
||
|' レコードセットをクローズ|
|rs.Close|
|Set rs = Nothing|
|Set db = Nothing|
|End Sub|`

|     |     |     |     |
| --- | --- | --- | --- |

m_calendar
|DateColumn|週区分|day of week|holiday|
|2025/04/01|1|火曜日||
|2025/04/02|1|水曜日||
|2025/04/03|1|木曜日||
|2025/04/04|1|金曜日||
|2025/04/05|1|土曜日|1|
|2025/04/06|2|日曜日|1|
|2025/04/07|2|月曜日||
|2025/04/08|2|火曜日||
|2025/04/09|2|水曜日||
|2025/04/10|2|木曜日||
|2025/04/11|2|金曜日||
|2025/04/12|2|土曜日|1|
|2025/04/13|3|日曜日|1|
|2025/04/14|3|月曜日||
|2025/04/15|3|火曜日||
|2025/04/16|3|水曜日||
|2025/04/17|3|木曜日||
|2025/04/18|3|金曜日||

**m_calendar_holiday**
|DateColumn|holiday|
|---|---|
|2025/04/01||
|2025/04/02||
|2025/04/03||
|2025/04/04||
|2025/04/05|1|
|2025/04/06|1|
|2025/04/07||
|2025/04/08||
|2025/04/09||
|2025/04/10||
|2025/04/11||
|2025/04/12|1|
|2025/04/13|1|
|2025/04/14||
|2025/04/15||
|2025/04/16||
|2025/04/17||
|2025/04/18||
|2025/04/19|1|
|2025/04/20|1|
|2025/04/21||
|2025/04/22||
|2025/04/23||
|2025/04/24||
|2025/04/25||
|2025/04/26|1|
|2025/04/27|1|
|2025/04/28||
|2025/04/29|1|
|2025/04/30|1|
|2025/05/01|1|
|2025/05/02|1|
|2025/05/03|1|

**m*calendar*稼働日数**
|年月|稼働日|休日|
|---|---|---|
|2025/04|30|10|
|2025/05|31|13|
|2025/06|30|9|
|2025/07|31|9|
|2025/08|31|15|
|2025/09|30|9|
|2025/10|31|9|
|2025/11|30|12|
|2025/12|31|10|
|2026/01|31|12|
|2026/02|28|9|
|2026/03|31|10|

成果物
**pc*生産実績*明細**
|転記日付|ネットワーク・指図番号|品目コード|品目テキスト|計画数|完成数|金額|mrp 管理者|週区分|
|---|---|---|---|---|---|---|---|---|
|2025/07/24|50119965|PZZA0537302|IK-5373A S02|2|2|53628|PC1|4|
|2025/07/24|50119401|P0A568802|WK-5688A U02 400A CTRL(J)|3|3|40779|PC1|4|
|2025/07/24|50120091|P0A611800|WK-6118 CO2 CONNECT|100|100|238100|PC5|4|
|2025/07/24|50119925|P0A530800|IK-5308 D (F) TOTAL CTRL|5|4|183452|PC1|4|
|2025/07/24|50120269|P00A0739123|IK-7391B U23|1|1|69158|PC2|4|
|2025/07/24|50119974|PZZA0109375|GK-1093B U75 4V|2|2|41244|PC1|4|
|2025/07/24|50119973|PZZA0109374|GK-1093B U74 60MV|2|2|41262|PC1|4|
|2025/07/24|50119803|P0A603500|WK-6035A PWM.PCB|6|6|52398|PC1|4|
|2025/07/24|50119360|P0A559400|WK-5594A TRANS TAP|50|50|553250|PC1|4|
|2025/07/24|50117923|P0A467500|MK-4675 LD OPEN DET.PCB|6|6|58788|PC1|4|
|2025/07/24|50119939|P00A0764300|IK-7643A CNV ﾌｨﾙﾀ/出力 PCB|10|10|179320|PC1|4|
|2025/07/24|50119944|P00A0734416|IK-7344B U16|5|5|77560|PC1|4|
|2025/07/24|50119706|P00A0719700|WK-7197A KP CTRL|20|20|399400|PC1|4|

**pc*生産実績*日別集計**
|週区分|完成日|日付|PC1|PC2|PC4|PC5|PC6|日別金額|
|---|---|---|---|---|---|---|---|---|
|1|2025/07/02|2025/07/02|5065722||377740|||5443462|
|1|2025/07/03|2025/07/03|997558||288762||551300|1837620|
|1|2025/07/04|2025/07/04|1544577|||||1544577|
|2|2025/07/07|2025/07/07|2267084||17170|343931||2628185|
|2|2025/07/08|2025/07/08|1647811|||||1647811|
|2|2025/07/09|2025/07/09|2031525||21756|||2053281|
|2|2025/07/10|2025/07/10|931052||334050|||1265102|
|2|2025/07/11|2025/07/11|1545689|||||1545689|
|3|2025/07/14|2025/07/14|1354402|80210||700000||2134612|
|3|2025/07/15|2025/07/15|6032591|312819||737500||7082910|
|3|2025/07/16|2025/07/16|1314389||45090|96048||1455527|
|3|2025/07/17|2025/07/17|768745|||155106||923851|
|3|2025/07/18|2025/07/18|2504680||668100|||3172780|
|3|2025/07/19|2025/07/19|166400|||||166400|
|4|2025/07/22|2025/07/22|2380624|||||2380624|
|4|2025/07/23|2025/07/23|1086860|||||1086860|
|4|2025/07/24|2025/07/24|1681081|69158||569057||2319296|
|合計||合計|33320790|462187|1752668|2601642|551300|38688587|

**pc*生産実績*週別集計**
|週区分|PC1|PC2|PC4|PC5|PC6|合計|
|---|---|---|---|---|---|---|
|1|7,607,857.00||666,502.00||551,300.00|8,825,659.00|
|2|8,423,161.00||372,976.00|343,931.00||9,140,068.00|
|3|12,141,207.00|393,029.00|713,190.00|1,688,654.00||14,936,080.00|
|4|5,148,565.00|69,158.00||569,057.00||5,786,780.00|
|合計|33,320,790.00|462,187.00|1,752,668.00|2,601,642.00|551,300.00|38,688,587.00|
