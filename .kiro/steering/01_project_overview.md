---
title: プロジェクト概要
inclusion: always
---

# 毎日のデータ更新処理刷新ツール

## プロジェクト概要

既存の手動データ更新処理を自動化・効率化するためのPythonツールです。多様な形式（CSV, TXT, Excel）のデータファイルを読み込み、SQLiteデータベースに一括で取り込みます。

## 主要コンポーネント

1. **`src/main.py`** - メインのバッチ処理プログラム
   - 優先順位CSVファイルに基づいてファイルを一括処理
   - テーブル構造の自動最終化（主キー追加＋インデックス作成）
   - テーブル名の自動変換（日本語や特殊文字を避ける）

2. **`src/core/sqlite_manager.py`** - 統一SQLite管理クラス
   - ファイル処理の統一インターフェース
   - エンコーディング自動検出
   - テーブル構造最適化
   - 特殊ファイル（zm37.txt, PP_SUMMARY_ZTBP080_KOJOZISSEKI_D_0.xlsx）の処理
   - データ型の自動最適化（日付、8桁数値、コードなど）

3. **`src/core/sqlite_gui_tool_v2_fixed.py`** - GUI検証・修正ツール
   - 個別ファイルの処理と検証
   - エラー再処理機能
   - データベース管理機能
   - テーブル名の自動変換

## 最新の改修内容

1. **zm37.txtの処理問題の解決**:
   - CP932エンコーディングと特殊な区切り文字に対応
   - Pythonエンジンとの互換性問題を解決

2. **特殊なExcelファイルの処理**:
   - PP_SUMMARY_ZTBP080_KOJOZISSEKI_D_0.xlsx のヘッダー7行対応
   - 8行目をフィールド名として読み込む処理

3. **テーブル名の修正**:
   - 日本語や特殊文字を含むテーブル名を適切に変換
   - 日本語テーブル名には `t_` プレフィックスとハッシュ値を付与
   - 特殊文字は `_` に置換

4. **データ型の修正**:
   - 日付カラムの自動検出と変換
   - 8桁数値の日付形式（YYYYMMDD）の検出と変換
   - コードカラムの文字列型保持

## 技術スタック

- **言語**: Python 3.8+
- **データベース**: SQLite
- **主要ライブラリ**:
  - pandas: データ処理
  - sqlite3: データベース操作
  - tkinter: GUIインターフェース
  - chardet: エンコーディング検出

## 開発ガイドライン

1. **コーディング規約**:
   - PEP 8に準拠したコードスタイル
   - 関数とクラスには適切なドキュメンテーションを追加
   - 型ヒントを使用して可読性を向上

2. **エラーハンドリング**:
   - 例外は適切にキャッチし、ログに記録
   - ユーザーに分かりやすいエラーメッセージを表示
   - 致命的でないエラーは処理を継続

3. **パフォーマンス考慮事項**:
   - 大きなファイルはチャンク処理
   - インデックスを適切に使用
   - トランザクションを効果的に活用

## 主要ファイル構造

```
claude-test/
├── src/
│   ├── main.py                # メイン実行スクリプト
│   └── core/
│       ├── sqlite_manager.py  # DB操作のコアロジック
│       └── sqlite_gui_tool_v2_fixed.py  # GUI検証ツール
├── config/
│   ├── constants.py           # 設定定数
│   ├── テキスト一覧.csv       # 処理対象ファイル定義
│   └── index_definitions.txt  # インデックス定義
├── data/
│   ├── raw/                   # 入力データファイル
│   └── sqlite/                # 出力SQLiteデータベース
├── docs/                      # プロジェクトドキュメント
│   ├── テーブル課題対応状況.md  # 課題対応状況
│   └── 主キーとインデックスの設定方法.md  # 設定方法の説明
└── logs/                      # ログファイル
```